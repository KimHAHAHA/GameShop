<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KIMKY STORE - My Cart</title>
  </head>
  <body>
    <app-header></app-header>

    <main class="container">
      <h2>üõí My Cart</h2>

      <!-- ‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏¢‡∏π‡πà -->
      <div *ngIf="isLoading" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

      <!-- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Å‡∏° -->
      <div *ngIf="!isLoading && cart.length === 0" class="empty">
        ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Å‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      </div>

      <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏° -->
      <div class="game-list" *ngIf="cart.length > 0">
        <div class="game-card" *ngFor="let g of cart">
          <div class="info">
            <p class="title">{{ g.title }}</p>
            <img
              [src]="
                g.image_url ||
                'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'
              "
              [alt]="g.title"
            />
          </div>
          <button class="delete-btn" (click)="removeFromCart(g.gid)">‚úñ</button>
        </div>
      </div>

      <!-- ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤ + ‡∏õ‡∏∏‡πà‡∏°‡∏ã‡∏∑‡πâ‡∏≠ -->
      <div *ngIf="cart.length > 0" class="cart-footer">
        <p>
          ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>{{ totalPrice | currency : "THB" }}</strong>
        </p>
        <button class="buy-btn" (click)="checkout()" [disabled]="isLoading">
          {{ isLoading ? "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£..." : "BUY" }}
        </button>
      </div>
    </main>

    <!-- Popup -->
    <!-- Popup -->
    <div
      class="popup-overlay"
      *ngIf="showPopup"
      style="
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      "
    >
      <div
        class="popup-box"
        style="
          background: #111;
          color: #fff;
          padding: 20px;
          border-radius: 8px;
          border: 1px solid #00ffff;
          min-width: 320px;
          box-shadow: 0 0 12px rgba(0, 255, 195, 0.4);
        "
      >
        <h3 style="text-align: center; margin-top: 1rem">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h3>

        <p class="price" style="margin-bottom: 8px">
          ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span>{{ totalPrice | currency : "THB" }}</span>
        </p>

        <p *ngIf="discountPercent > 0" style="color: #00ffc3">
          üéâ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏•‡∏î:
          <strong>{{ discountedPrice | currency : "THB" }}</strong> (‡∏•‡∏î
          {{ discountPercent }}%)
        </p>

        <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î -->
        <div style="margin-top: 10px">
          <label
            for="discount"
            style="display: block; margin-bottom: 6px; font-weight: 500"
          >
            ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î:
          </label>
          <input
            id="discount"
            type="text"
            [(ngModel)]="discountCode"
            placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"
            style="
              width: 93%;
              padding: 8px 10px;
              border-radius: 6px;
              border: 1px solid #00ffff;
              background: #000;
              color: #fff;
              outline: none;
            "
          />
          <!-- <button
            (click)="applyDiscount()"
            style="
              margin-top: 8px;
              background: #00ffc3;
              color: #000;
              border: none;
              padding: 6px 12px;
              border-radius: 5px;
              cursor: pointer;
              font-weight: 600;
            "
          >
            ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î
          </button> -->
        </div>

        <div
          class="popup-btns"
          style="
            margin-top: 20px;
            text-align: right;
            display: flex;
            justify-content: center;
            gap: 12px;
          "
        >
          <button
            (click)="closePopup()"
            style="
              background: #444;
              color: #fff;
              border: none;
              padding: 8px 14px;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            Cancel
          </button>

          <button
            (click)="confirmCheckout()"
            style="
              background: #00ffc3;
              color: #000;
              border: none;
              padding: 8px 14px;
              border-radius: 5px;
              cursor: pointer;
              font-weight: 600;
            "
          >
            Confirm
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
